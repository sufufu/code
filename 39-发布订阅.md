## 发布订阅准备

DOM 2级怎么实现可以给一个元素的同一个事件绑定多个事件函数？？？

因为 DOM2 级事件给每个元素的每个事件都设置了一个事件池，类似数组；每次 addEventListener() 都是像事件池中添加函数
+ 等到事件真正触发的时候，把函数从事件池中一个一个的拿出来执行一下；
+ js 中的事件是元素或者浏览器发生特定的交互瞬间；也就说事件是一个时刻；

事件思想：所有的时刻都可以称为一个事件，例如5s后、动画结束后 都是一个具体的时刻，所以5s后和动画结束后都可以叫做事件；

?? 思考：既然5s后和动画结束后都是事件，那么怎么监听这些事件？事件发生时怎么让事件函数执行？

发布订阅：模拟 DOM2 级事件的事件池思想，当某一个时刻到来我们要做很多事情（执行很多个函数）；准备一个数组当做事件池，并且提供向事件池中添加函数以及移除函数的方法，并且等到该时刻到来时把事件池中的函数一个一个的执行了；这种解决问题的方法称为发布订阅模式（观察者模式）；


## 发布订阅

```javascript
// 发布订阅：
// 订阅：订阅某个时刻到来时，把要做的事情放到事件池中；
// 发布：时刻到来，把事件池中的方法都执行了；

// 1. 准备一个数组当做事件池
let ary = [];

// 2. 提供向事件池中添加订阅的方法
function addEvent(fn) {
  // fn 订阅某个时刻到来时要做的事情
  // DOM2 事件不能重复绑定同一个事件函数
  if (!ary.includes(fn)) ary.push(fn); // 表示事件池不包含 fn 时再添加 fn
}

// 3. 提供取消订阅的方法（把函数从数组中移除）
function removeEvent(fn) {
  // 把 fn 从 ary 移除掉（可以使用 splice 删除，但是会导致数组塌陷）

  // 数组.filter(callback) 利用 filter 把 ary 改成除了 fn 以外的组成的新数组；
  ary = ary.filter(function (item, index) {
    return item !== fn;
  });
}

// 4. 提供一个发布事件的方法
function fire(...arg) {
  ary.forEach(item => item(...arg)); // 把事件池中的函数一个一个的拿出来执行，并且在执行的时候传一些参数
}

function fn1() {
  console.log(1);
}
function fn2() {
  console.log(2);
}
function fn3() {
  console.log(3);
}

// 订阅 5s 后执行fn1、fn2、fn3

addEvent(fn1);
addEvent(fn2);
addEvent(fn3);

removeEvent(fn3);

setTimeout(() => {
  fire(); // 3s以后发布事件
}, 3000);

```